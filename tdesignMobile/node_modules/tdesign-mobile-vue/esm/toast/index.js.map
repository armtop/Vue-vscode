{"version":3,"file":"index.js","sources":["../../src/toast/index.ts"],"sourcesContent":["import { createApp, App, DefineComponent } from 'vue';\nimport vueToast from './toast.vue';\nimport { TdToastProps } from './type';\nimport { WithInstallType, isBrowser } from '../shared';\n\nimport './style';\n\nexport * from './type';\nexport type ToastProps = TdToastProps;\n\nlet instance: any = null;\nlet app: App<Element>;\n\n/** 展示提示 */\nfunction Toast(props: string | Partial<TdToastProps>): DefineComponent<TdToastProps> {\n  if (!isBrowser) return;\n  const root = document.createElement('div');\n  document.body.appendChild(root);\n\n  const propsObject = {\n    duration: 2000,\n    ...parseOptions(props),\n  };\n\n  if (instance) {\n    instance.clear();\n  }\n\n  instance = vueToast;\n\n  instance.clear = () => {\n    clearTimeout(instance.timer);\n    app.unmount();\n    root.remove();\n    if (propsObject.onClose) {\n      propsObject.onClose();\n    }\n    instance = null;\n  };\n\n  if (propsObject.duration && propsObject.duration > 0) {\n    instance.timer = setTimeout(() => {\n      instance.clear();\n      if (propsObject.onDestroy) {\n        propsObject.onDestroy();\n      }\n    }, propsObject.duration);\n  }\n\n  app = createApp(instance, { ...propsObject });\n  app.mount(root);\n\n  return instance;\n}\n\nToast.clear = () => {\n  if (instance) {\n    instance.clear();\n  }\n};\n\n(['loading', 'success', 'error'] as TdToastProps['theme'][]).forEach((type): void => {\n  if (!type) {\n    return;\n  }\n  Toast[type] = (options: TdToastProps | string) => {\n    let props = { message: '', theme: type } as unknown as TdToastProps;\n\n    if (typeof options === 'string') {\n      props.message = options;\n    } else {\n      props = { ...props, ...options };\n    }\n\n    return Toast(props);\n  };\n});\n\nfunction parseOptions(message?: Partial<TdToastProps> | string) {\n  if (typeof message === 'string') {\n    return { message };\n  }\n  return message;\n}\n\nToast.install = (app: App) => {\n  // 添加插件入口\n  // eslint-disable-next-line no-param-reassign\n  app.config.globalProperties.$toast = Toast as any;\n};\n\ntype ToastApi = {\n  /** 展示提示 */\n  (options?: Partial<TdToastProps> | string): void;\n  /** 展示加载提示 */\n  loading: (options?: Partial<TdToastProps> | string) => void;\n  /** 展示成功提示 */\n  success: (options?: Partial<TdToastProps> | string) => void;\n  /** 展示失败提示 */\n  error: (options?: Partial<TdToastProps> | string) => void;\n  /** 关闭提示 */\n  clear: () => void;\n};\n\nexport const ToastPlugin: WithInstallType<typeof vueToast> & ToastApi = Toast as any;\nexport default ToastPlugin;\n\ndeclare module '@vue/runtime-core' {\n  // Bind to `this` keyword\n  export interface ComponentCustomProperties {\n    $toast: ToastApi;\n  }\n}\n"],"names":["instance","app","Toast","props","isBrowser","root","document","createElement","body","appendChild","propsObject","_objectSpread","duration","parseOptions","clear","vueToast","clearTimeout","timer","unmount","remove","onClose","setTimeout","onDestroy","createApp","mount","forEach","type","options","message","theme","install","config","globalProperties","$toast","ToastPlugin"],"mappings":"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"}