{"version":3,"file":"index.js","sources":["../../src/upload/upload.tsx","../../src/upload/index.ts"],"sourcesContent":["import { defineComponent, ref, computed, toRefs } from 'vue';\nimport { AddIcon, LoadingIcon, CloseIcon, CloseCircleIcon } from 'tdesign-icons-vue-next';\n\nimport TImage from '../image';\nimport TImageViewer from '../image-viewer';\nimport { UploadFile } from './type';\nimport UploadProps from './props';\nimport config from '../config';\nimport useUpload from './hooks/useUpload';\nimport { useTNodeJSX, useContent } from '../hooks/tnode';\nimport { useConfig } from '../config-provider/useConfig';\n\nconst { prefix } = config;\nconst name = `${prefix}-upload`;\n\nexport default defineComponent({\n  name,\n  components: {\n    AddIcon,\n    LoadingIcon,\n    CloseCircleIcon,\n    CloseIcon,\n    TImage,\n    TImageViewer,\n  },\n  props: UploadProps,\n  emits: [\n    'update:files',\n    'update:modelValue',\n    'change',\n    'fail',\n    'preview',\n    'progress',\n    'remove',\n    'success',\n    'select-change',\n    'validate',\n    'click-upload',\n  ],\n  setup(props, context) {\n    const { globalConfig } = useConfig('upload');\n\n    const {\n      toUploadFiles,\n      uploadValue,\n      displayFiles,\n      sizeOverLimitMessage,\n      uploading,\n      inputRef,\n      disabled,\n      xhrReq,\n      uploadFilePercent,\n      uploadFiles,\n      onFileChange,\n      onNormalFileChange,\n      onInnerRemove,\n      cancelUpload,\n    } = useUpload(props);\n\n    const renderTNodeJSX = useTNodeJSX();\n    const renderContent = useContent();\n\n    const showViewer = ref(false);\n    const initialIndex = ref(0);\n\n    const handlePreview = (e: MouseEvent, file: UploadFile, index: number) => {\n      initialIndex.value = index;\n      showViewer.value = true;\n      props.onPreview?.({\n        e,\n        file,\n        index,\n      });\n    };\n\n    const triggerUpload = (e: MouseEvent) => {\n      const input = inputRef.value as HTMLInputElement;\n      if (disabled?.value) return;\n      input.click();\n      props.onClickUpload?.({\n        e,\n      });\n    };\n\n    const previewImgs = computed(() => {\n      return displayFiles.value.map((item) => item.url as string);\n    });\n\n    const handleImageClose = ({ visible }: { visible: boolean }) => {\n      showViewer.value = visible;\n    };\n\n    const renderStatus = (file: UploadFile) => {\n      if (file.status === 'fail' || file.status === 'progress') {\n        return (\n          <div class={`${name}__progress-mask`}>\n            {file.status === 'progress' ? (\n              <>\n                <loading-icon class={`${name}__progress-loading`} size=\"24\" />\n                <div class={`${name}__progress-text`}>\n                  {file.percent ? `${file.percent}%` : globalConfig.value.progress.uploadingText}\n                </div>\n              </>\n            ) : (\n              <close-circle-icon size=\"24\" />\n            )}\n            {file.status === 'fail' && (\n              <div class={`${name}__progress-text`}>{globalConfig.value.progress.failText}</div>\n            )}\n          </div>\n        );\n      }\n    };\n\n    const content = () => {\n      const defaultContent = renderContent('default', 'content');\n      const addContent = renderTNodeJSX('addContent');\n      if (props.max === 0 || (props.max > 0 && displayFiles.value?.length < props.max)) {\n        if (defaultContent) {\n          return <div onClick={triggerUpload}>{defaultContent}</div>;\n        }\n        return (\n          <div class={`${name}__item ${name}__item--add`} onClick={triggerUpload}>\n            <div class={`${name}__add-icon`}>{addContent || <add-icon size=\"28\" />}</div>\n          </div>\n        );\n      }\n    };\n\n    return {\n      ...toRefs(props),\n      name,\n      globalConfig,\n      initialIndex,\n      showViewer,\n      previewImgs,\n      toUploadFiles,\n      uploadValue,\n      displayFiles,\n      sizeOverLimitMessage,\n      uploading,\n      inputRef,\n      disabled,\n      xhrReq,\n      handlePreview,\n      triggerUpload,\n      uploadFilePercent,\n      uploadFiles,\n      onFileChange,\n      onNormalFileChange,\n      onInnerRemove,\n      cancelUpload,\n      handleImageClose,\n      renderStatus,\n      content,\n    };\n  },\n  render() {\n    return (\n      <div class={`${name}`}>\n        {this.displayFiles.map((file, index) => (\n          <div key={index} class={`${name}__item`}>\n            {file.url && (\n              <t-image\n                class={`${name}__image`}\n                shape=\"round\"\n                {...(this.$props.imageProps as object)}\n                src={file.url}\n                onClick={(e: MouseEvent) => this.handlePreview(e, file, index)}\n              />\n            )}\n            {this.renderStatus(file)}\n            <close-icon\n              class={`${name}__delete-btn`}\n              onClick={({ e }: any) => this.onInnerRemove({ e, file, index })}\n            />\n          </div>\n        ))}\n        {this.content()}\n        <input\n          ref=\"inputRef\"\n          value={this.$props.files}\n          type=\"file\"\n          multiple={this.$props.multiple}\n          hidden\n          accept={this.$props.accept}\n          onChange={this.onNormalFileChange}\n        />\n        <t-image-viewer\n          visible={this.showViewer}\n          images={this.previewImgs}\n          index={this.initialIndex}\n          onClose={this.handleImageClose}\n        />\n      </div>\n    );\n  },\n});\n","import { withInstall, WithInstallType } from '../shared';\nimport Upload from './upload';\nimport './style';\n\nconst _Upload: WithInstallType<typeof Upload> = withInstall(Upload);\nexport default _Upload;\n"],"names":["prefix","config","name","defineComponent","components","AddIcon","LoadingIcon","CloseCircleIcon","CloseIcon","TImage","TImageViewer","props","UploadProps","emits","setup","context","_useConfig","useConfig","globalConfig","_useUpload","useUpload","toUploadFiles","uploadValue","displayFiles","sizeOverLimitMessage","uploading","inputRef","disabled","xhrReq","uploadFilePercent","uploadFiles","onFileChange","onNormalFileChange","onInnerRemove","cancelUpload","renderTNodeJSX","useTNodeJSX","renderContent","useContent","showViewer","ref","initialIndex","handlePreview","e","file","index","_props$onPreview","value","onPreview","call","triggerUpload","_props$onClickUpload","input","click","onClickUpload","previewImgs","computed","map","item","url","handleImageClose","_ref","visible","renderStatus","status","_createVNode","concat","_Fragment","_resolveComponent","percent","progress","uploadingText","failText","content","_displayFiles$value","defaultContent","addContent","max","length","_objectSpread","toRefs","render","_this","$props","imageProps","onClick","_ref2","files","multiple","accept","_Upload","withInstall","Upload"],"mappings":"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"}