{"version":3,"file":"index.js","sources":["../../src/sticky/sticky.tsx","../../src/sticky/index.ts"],"sourcesContent":["import { computed, defineComponent, ref, watch } from 'vue';\nimport { useElementBounding } from '@vueuse/core';\nimport StickyProps from './props';\nimport config from '../config';\nimport { usePrefixClass } from '../hooks/useClass';\nimport { useTNodeJSX } from '../hooks/tnode';\n\nconst name = `${config.prefix}-sticky`;\n\nexport default defineComponent({\n  name,\n  props: StickyProps,\n  setup(props) {\n    const renderTNodeJSX = useTNodeJSX();\n    const stickyBarClass = usePrefixClass('sticky');\n\n    // box 用于占位和记录边界\n    // content 用于实际定位\n    const boxRef = ref<HTMLElement>();\n    const { top: boxTop } = useElementBounding(boxRef);\n    const contentRef = ref<HTMLElement>();\n    const { top: contentTop, height } = useElementBounding(contentRef);\n\n    const stickyStyle = computed(() => `height:${height.value}px;`);\n\n    // container 容器，sticky不会超出该边界\n    let container: HTMLElement;\n    const containerHeight = ref(0);\n    const containerTop = ref(0);\n\n    // 监听页面滚动事件\n    watch(boxTop, () => {\n      if (props.container) {\n        // @ts-ignore\n        container = document.querySelector(props.container);\n        const { top, height } = container.getBoundingClientRect();\n        containerHeight.value = height;\n        containerTop.value = top;\n      }\n    });\n\n    // 通过改变 content 的定位来实现 sticky 效果\n    const contentStyles = computed(() => {\n      let styleStr = `z-index:${props.zIndex};`;\n      let isFixed = false;\n      if (props.disabled) return styleStr;\n      const offsetTop = Number(props.offsetTop);\n      if (container) {\n        if (containerHeight.value + containerTop.value < offsetTop + height.value) {\n          styleStr += `transform:translate3d(0, ${containerHeight.value - height.value}px, 0);`;\n        } else if (boxTop.value <= offsetTop) {\n          styleStr += `position:fixed;top:${offsetTop}px;`;\n          isFixed = true;\n        }\n      } else if (boxTop.value <= offsetTop) {\n        styleStr += `position:fixed;top:${offsetTop}px;`;\n        isFixed = true;\n      }\n      props.onScroll?.({ scrollTop: contentTop.value, isFixed });\n      return styleStr;\n    });\n\n    return () => (\n      <div ref={boxRef} class={stickyBarClass.value} style={stickyStyle.value}>\n        <div ref={contentRef} class={`${stickyBarClass.value}__content`} style={contentStyles.value}>\n          {renderTNodeJSX('default')}\n        </div>\n      </div>\n    );\n  },\n});\n","import Sticky from './sticky';\nimport { withInstall, WithInstallType } from '../shared';\nimport { TdStickyProps } from './type';\n\nimport './style';\n\nexport * from './type';\nexport type StickyProps = TdStickyProps;\n\nconst _Sticky: WithInstallType<typeof Sticky> = withInstall(Sticky);\nexport default _Sticky;\n"],"names":["name","concat","config","prefix","defineComponent","props","StickyProps","setup","renderTNodeJSX","useTNodeJSX","stickyBarClass","usePrefixClass","boxRef","ref","_useElementBounding","useElementBounding","boxTop","top","contentRef","_useElementBounding2","contentTop","height","stickyStyle","computed","value","container","containerHeight","containerTop","watch","document","querySelector","_container$getBoundin","getBoundingClientRect","contentStyles","_props$onScroll","styleStr","zIndex","isFixed","disabled","offsetTop","Number","onScroll","call","scrollTop","_createVNode","_Sticky","withInstall","Sticky"],"mappings":"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"}