{"version":3,"file":"picker.class.js","sources":["../../src/picker/picker.class.ts"],"sourcesContent":["import config from '../config';\nimport { preventDefault } from '../shared/dom';\n\nconst { prefix } = config;\n\nexport interface PickerOptions {\n  defaultIndex?: number;\n  el: HTMLElement | HTMLDivElement | HTMLUListElement;\n  onChange: (index: number) => void;\n}\n\nconst quartEaseOut = function (t: number, b: number, c: number, d: number) {\n  let tempT = t;\n  return -c * ((tempT = tempT / d - 1) * tempT * tempT * tempT - 1) + b;\n};\n\n/**\n * constant var\n */\nexport const DEFAULT_ITEM_HEIGHT = 40;\nconst DEFAULT_HOLDER_HEIGHT = 200;\nconst OFFSET_OF_BOUND = 60;\nexport const ANIMATION_TIME_LIMIT = 460;\nconst ANIMATION_DURATION = 150;\n\n/**\n * @name picker\n * @description 阻尼参数来源iscroll5，灵感来自mui.picker\n * @param {[HTMLDivElement]} el   [picker-item的DOM元素]\n * @param {[Function]} onChange   [发生change事件时候的回调]\n * @param {[Number]} defaultIndex [picker-item开始的索引值]\n */\nclass Picker {\n  holder: HTMLElement | HTMLUListElement;\n\n  options: PickerOptions;\n\n  list: HTMLUListElement | null = null;\n\n  elementItems: HTMLLIElement[] = [];\n\n  height: number = DEFAULT_HOLDER_HEIGHT;\n\n  curIndex = 0;\n\n  itemClassName = '';\n\n  itemSelectedClassName = '';\n\n  itemHeight: number = DEFAULT_ITEM_HEIGHT;\n\n  lastMoveTime = 0;\n\n  lastMoveStart = 0;\n\n  stopInertiaMove = false;\n\n  startY = 0;\n\n  isPicking = false;\n\n  offsetYOfStartBound: number = OFFSET_OF_BOUND;\n\n  offsetYOfEndBound: number = -OFFSET_OF_BOUND;\n\n  offsetY = 0;\n\n  offsetYOfStart = 0;\n\n  offsetYOfEnd = 0;\n\n  curValue: string | null = '';\n\n  onChange: (index: number) => void;\n\n  constructor(options: PickerOptions) {\n    if (!options.el) throw new Error('options el needed!');\n    this.holder = options.el;\n    this.options = options;\n    this.onChange = options.onChange;\n    this.init();\n  }\n\n  init(): void {\n    // 惯性滚动\n    this.initScrollParams();\n    // item 样式\n    this.setSelectedClassName();\n    // 绑定事件\n    this.bindEvent();\n  }\n\n  /**\n   * @description 获取所有的列表DOM元素\n   */\n  updateItems(): void {\n    this.elementItems = [...this.holder.querySelectorAll('li')];\n    const itemLen = this.elementItems.length;\n    this.offsetYOfEnd = -this.itemHeight * (itemLen - 3);\n    this.offsetYOfEndBound = -(this.itemHeight * (itemLen - 3) + OFFSET_OF_BOUND);\n  }\n\n  /**\n   * @description 初始化滚动参数\n   */\n  initScrollParams(): void {\n    this.list = this.holder as HTMLUListElement;\n    this.elementItems = [...this.holder.querySelectorAll('li')];\n    this.itemHeight = this.holder.querySelector('li')?.offsetHeight || DEFAULT_ITEM_HEIGHT;\n    this.height = this.holder.offsetHeight || DEFAULT_HOLDER_HEIGHT;\n    let curIndex = this.options.defaultIndex || 0;\n    this.itemClassName = `${prefix}-picker-item__item`;\n    this.itemSelectedClassName = `${prefix}-picker-item__item--active`;\n    this.itemHeight = DEFAULT_ITEM_HEIGHT;\n    this.startY = 0;\n    this.isPicking = false;\n    this.lastMoveTime = 0;\n    this.lastMoveStart = 0;\n    this.stopInertiaMove = false;\n    this.curValue = this.elementItems[curIndex]?.textContent;\n    Object.defineProperty(this, 'curIndex', {\n      set: (value: number) => {\n        curIndex = value;\n        this.curValue = this.elementItems[value]?.textContent;\n      },\n      get() {\n        return curIndex;\n      },\n    });\n    const startOffsetY = (-this.curIndex + 2) * this.itemHeight;\n    const itemLen = this.elementItems.length;\n    this.setOffsetY(startOffsetY);\n    this.offsetYOfStart = startOffsetY;\n    this.offsetYOfEnd = -this.itemHeight * (itemLen - 3);\n    this.offsetYOfStartBound = this.itemHeight * 2 + OFFSET_OF_BOUND;\n    this.offsetYOfEndBound = -(this.itemHeight * (itemLen - 3) + OFFSET_OF_BOUND);\n  }\n\n  bindEvent(): void {\n    this.holder.addEventListener('touchstart', (e) => this.touchStartHandler(e as TouchEvent), false);\n    this.holder.addEventListener('touchmove', (e) => this.touchMoveHandler(e as TouchEvent), false);\n    this.holder.addEventListener('touchend', (e) => this.touchEndHandler(e as TouchEvent), false);\n    this.holder.addEventListener('touchcancel', (e) => this.touchEndHandler(e as TouchEvent), false);\n  }\n\n  touchStartHandler(event: TouchEvent): void {\n    preventDefault(event, false);\n    this.isPicking = true;\n    if (!this.holder) return;\n    if (this.list) this.list.style.transition = '';\n    this.startY = event.changedTouches[0].pageY;\n    // 更新惯性参数\n    this.updateInertiaParams(event, true);\n  }\n\n  touchMoveHandler(event: TouchEvent): void {\n    preventDefault(event, false);\n    if (!this.isPicking || !this.holder) return;\n    const endY = event.changedTouches[0].pageY;\n    const dragRange = endY - this.startY;\n    this.updateInertiaParams(event, false);\n    const moveOffsetY = (-this.curIndex + 2) * this.itemHeight + dragRange;\n    this.setOffsetY(moveOffsetY);\n  }\n\n  touchEndHandler(event: TouchEvent): void {\n    preventDefault(event, false);\n    this.isPicking = false;\n    if (!this.holder) return;\n    const point = event.changedTouches[0];\n    const nowTime = event.timeStamp || Date.now();\n    // move time gap\n    const moveTime = nowTime - this.lastMoveTime;\n    // 超出一定时间不再惯性滚动\n    if (moveTime > ANIMATION_TIME_LIMIT) {\n      this.stopInertiaMove = false;\n      this.endScroll();\n      return;\n    }\n    // 手指滑动的速度\n    const v = (point.pageY - this.lastMoveStart) / moveTime;\n    // 加速度方向\n    const dir = v > 0 ? -1 : 1;\n    // 摩擦系数，参考iscroll的阻尼系数\n    const dampingCoefficient = 0.0008;\n    // 加速度\n    const deceleration = -1 * dir * dampingCoefficient;\n    // 滚动持续时间\n    const duration = Math.abs(v / deceleration);\n    const endY = event.changedTouches[0].pageY;\n    const dragRange = endY - this.startY;\n    // 滚动距离\n    const dist = v * duration - (duration ** 2 * deceleration) / 2 + dragRange;\n    if (dist === 0) {\n      this.stopInertiaMove = false;\n      this.endScroll();\n      return;\n    }\n    this.scrollDist(nowTime, this.offsetY, dist, duration);\n  }\n\n  /**\n   * @description 更新惯性参数\n   * @param event\n   * @param isStart\n   */\n  updateInertiaParams(event: TouchEvent, isStart: boolean): void {\n    const point = event.changedTouches[0];\n    if (isStart) {\n      this.lastMoveStart = point.pageY;\n      this.lastMoveTime = event.timeStamp || Date.now();\n    }\n    this.stopInertiaMove = true;\n  }\n\n  /**\n   * @description 根据计算的物理惯性距离滚动\n   * @param now\n   * @param startOffsetY\n   * @param dist\n   * @param duration\n   */\n  scrollDist(now: number, startOffsetY: number, dist: number, duration: number): void {\n    this.stopInertiaMove = false;\n    let start: any = null;\n    const inertiaMove = (timestamp: number) => {\n      if (this.stopInertiaMove) {\n        return;\n      }\n      if (!start) start = timestamp;\n      const progress = timestamp - start;\n      const newOffsetY = quartEaseOut(progress, startOffsetY, dist, duration);\n      this.setOffsetY(newOffsetY);\n      if (progress > duration || newOffsetY > this.offsetYOfStartBound || newOffsetY < this.offsetYOfEndBound) {\n        this.endScroll();\n      } else {\n        window.requestAnimationFrame(inertiaMove);\n      }\n    };\n    window.requestAnimationFrame(inertiaMove);\n  }\n\n  /**\n   * @description 更新picker，一般当数据变化需要ui更新的时候调用\n   */\n  update(options?: any): void {\n    this.updateItems();\n    const targetIndex = this.elementItems.findIndex((el: HTMLLIElement) => el.textContent === this.curValue);\n    const updateIndex = targetIndex === -1 ? 0 : targetIndex;\n    this.updateIndex(updateIndex, options);\n  }\n\n  /**\n   * @description 更新picker索引，数据变化时调用\n   * @param index\n   * @param duration\n   */\n  updateIndex(index: number, options?: any): void {\n    const realOptions = {\n      duration: 460,\n      isChange: true,\n      ...options,\n    };\n    this.curIndex = index;\n    this.setSelectedClassName();\n    const moveOffsetY = (-index + 2) * this.itemHeight;\n    if (this.list) {\n      this.list.style.transform = `translate(0,${moveOffsetY}px) translateZ(0)`;\n      this.list.style.transitionDuration = `${realOptions.duration}ms`;\n      this.list.style.transitionTimingFunction = 'ease-out';\n    }\n    realOptions.isChange && this.onChange(index);\n  }\n\n  /**\n   * @description 获取当前索引\n   */\n  getCurIndex(): number {\n    return this.curIndex;\n  }\n\n  /**\n   * @description 适配3d， TBD\n   * @param index\n   */\n  fix3d(index: number): void {\n    for (let i = 0; i < this.elementItems.length; i++) {\n      const deg = 25 * (-index + i);\n      this.elementItems[i].style.transform = `rotateX(${deg}deg)`;\n      this.elementItems[i].style.webkitTransform = `rotateX(${deg}deg)`;\n    }\n  }\n\n  /**\n   * @description 设置item样式\n   */\n  setSelectedClassName(): void {\n    const regClass = new RegExp(this.itemClassName, 'i');\n    const regSelected = new RegExp(this.itemSelectedClassName, 'i');\n    this.elementItems.forEach((item, i) => {\n      const tempItem = item;\n      const itemClass = tempItem.className;\n      if (itemClass === '' || !itemClass) {\n        tempItem.className = this.itemClassName;\n      } else {\n        if (!regClass.test(itemClass)) {\n          tempItem.classList.add(this.itemClassName);\n        }\n        if (regSelected.test(itemClass)) {\n          tempItem.classList.remove(this.itemSelectedClassName);\n        }\n      }\n      if (this.curIndex === i) {\n        tempItem.classList.add(this.itemSelectedClassName);\n      }\n    });\n  }\n\n  /**\n   * 设置当前picker的滚动位移\n   * @param offsetY\n   */\n  setOffsetY(offsetY: number): void {\n    this.offsetY = offsetY;\n    if (this.list) {\n      this.list.style.transform = `translate3d(0, ${offsetY}px, 0)`;\n    }\n  }\n\n  /**\n   * @description 结束滚动时的回调\n   */\n  endScroll(): void {\n    if (this.stopInertiaMove) return;\n    let curIndex = 0;\n    if (this.offsetY > this.offsetYOfStartBound) {\n      curIndex = 0;\n      if (this.list) {\n        this.list.style.transition = `${ANIMATION_DURATION}ms ease-out`;\n      }\n    } else if (this.offsetY < this.offsetYOfEndBound) {\n      curIndex = this.elementItems.length - 1;\n      if (this.list) {\n        this.list.style.transition = `${ANIMATION_DURATION}ms ease-out`;\n      }\n    } else {\n      if (this.list) {\n        this.list.style.transition = `${ANIMATION_DURATION}ms ease-out`;\n      }\n      curIndex = 2 - Math.round(this.offsetY / this.itemHeight);\n      if (curIndex < 0) curIndex = 0;\n      if (curIndex > this.elementItems.length - 1) curIndex = this.elementItems.length - 1;\n    }\n    const offsetY = (-curIndex + 2) * this.itemHeight;\n    this.setOffsetY(offsetY);\n    if (curIndex !== this.curIndex) {\n      // 防止事件重复触发\n      this.curIndex = curIndex;\n      this.setSelectedClassName();\n      this.onChange(this.curIndex);\n    }\n  }\n\n  destroy(): void {\n    // @ts-ignore: TODO\n    delete this.holder;\n  }\n}\n\nexport default Picker;\n"],"names":["prefix","config","quartEaseOut","t","b","c","d","tempT","DEFAULT_ITEM_HEIGHT","DEFAULT_HOLDER_HEIGHT","OFFSET_OF_BOUND","ANIMATION_TIME_LIMIT","ANIMATION_DURATION","Picker","options","_classCallCheck","_defineProperty","el","Error","holder","onChange","init","_createClass","key","value","initScrollParams","setSelectedClassName","bindEvent","updateItems","elementItems","querySelectorAll","itemLen","length","offsetYOfEnd","itemHeight","offsetYOfEndBound","_this$holder$querySel","_this$elementItems$cu","_this","list","querySelector","offsetHeight","height","curIndex","defaultIndex","itemClassName","itemSelectedClassName","startY","isPicking","lastMoveTime","lastMoveStart","stopInertiaMove","curValue","textContent","Object","defineProperty","set","_this$elementItems$va","get","startOffsetY","setOffsetY","offsetYOfStart","offsetYOfStartBound","_this2","addEventListener","e","touchStartHandler","touchMoveHandler","touchEndHandler","event","preventDefault","style","transition","changedTouches","pageY","updateInertiaParams","endY","dragRange","moveOffsetY","point","nowTime","timeStamp","Date","now","moveTime","endScroll","v","dir","dampingCoefficient","deceleration","duration","Math","abs","dist","pow","scrollDist","offsetY","isStart","_this3","start","inertiaMove","timestamp","progress","newOffsetY","window","requestAnimationFrame","update","_this4","targetIndex","findIndex","updateIndex","index","realOptions","_objectSpread","isChange","transform","concat","transitionDuration","transitionTimingFunction","getCurIndex","fix3d","i","deg","webkitTransform","_this5","regClass","RegExp","regSelected","forEach","item","tempItem","itemClass","className","test","classList","add","remove","round","destroy"],"mappings":"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"}