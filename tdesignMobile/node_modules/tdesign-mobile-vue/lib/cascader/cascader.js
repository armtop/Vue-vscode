/**
 * tdesign v1.2.3
 * (c) 2024 TDesign Group
 * @license MIT
 */

'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var _toConsumableArray = require('@babel/runtime/helpers/toConsumableArray');
var _slicedToArray = require('@babel/runtime/helpers/slicedToArray');
var tdesignIconsVueNext = require('tdesign-icons-vue-next');
var vue = require('vue');
var popup_index = require('../popup/index.js');
var tabs_index = require('../tabs/index.js');
var radio_index = require('../radio/index.js');
var config = require('../config.js');
var cascader_props = require('./props.js');
var configProvider_useConfig = require('../config-provider/useConfig.js');
var shared_renderTnode = require('../shared/render-tnode.js');
var shared_useVModel_index = require('../shared/useVModel/index.js');
var shared_render = require('../shared/render.js');
require('../popup/popup.js');
require('@babel/runtime/helpers/defineProperty');
require('../popup/props.js');
require('../overlay/index.js');
require('../shared/dom.js');
require('lodash/isFunction');
require('lodash/isString');
require('../shared/util.js');
require('lodash/isNumber');
require('../overlay/props.js');
require('../hooks/useClass.js');
require('../hooks/tnode.js');
require('lodash/camelCase');
require('lodash/kebabCase');
require('../hooks/render-tnode.js');
require('lodash/isEmpty');
require('lodash/isObject');
require('../shared/component.js');
require('lodash/cloneDeep');
require('../config-provider/context.js');
require('lodash/mergeWith');
require('lodash/merge');
require('lodash/isArray');
require('../_common/js/global-config/mobile/default-config.js');
require('../_common/js/global-config/mobile/locale/zh_CN.js');
require('../_chunks/dep-191173f8.js');
require('@babel/runtime/helpers/typeof');
require('../_chunks/dep-2088457f.js');
require('dayjs');
require('../shared/useDefault/index.js');
require('../tabs/props.js');
require('../tabs/tab-panel-props.js');
require('../shared/constants.js');
require('../sticky/index.js');
require('@vueuse/core');
require('../sticky/props.js');
require('../badge/index.js');
require('../badge/props.js');
require('../radio/props.js');
require('../form/hooks.js');
require('../shared/functions.js');
require('../radio/radio-group-props.js');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var _toConsumableArray__default = /*#__PURE__*/_interopDefaultLegacy(_toConsumableArray);
var _slicedToArray__default = /*#__PURE__*/_interopDefaultLegacy(_slicedToArray);

var prefix = config["default"].prefix;
var name = "".concat(prefix, "-cascader");
var childrenInfo = {
  value: "",
  level: 0
};
var script = vue.defineComponent({
  name: name,
  components: {
    ChevronRightIcon: tdesignIconsVueNext.ChevronRightIcon,
    TNode: shared_renderTnode["default"],
    TPopup: popup_index["default"],
    TTabs: tabs_index.Tabs,
    TTabPanel: tabs_index.TabPanel,
    TRadioGroup: radio_index.RadioGroup
  },
  props: cascader_props["default"],
  emits: ["change", "close", "pick", "update:modelValue", "update:value", "update:visible"],
  setup: function setup(props, context) {
    var _options$value;
    var _useConfig = configProvider_useConfig.useConfig("cascader"),
      globalConfig = _useConfig.globalConfig;
    var _toRefs = vue.toRefs(props),
      visible = _toRefs.visible,
      value = _toRefs.value,
      modelValue = _toRefs.modelValue,
      subTitles = _toRefs.subTitles,
      options = _toRefs.options,
      keys = _toRefs.keys,
      checkStrictly = _toRefs.checkStrictly;
    var open = vue.ref(visible.value || false);
    var _useVModel = shared_useVModel_index.useVModel(value, modelValue, props.defaultValue, props.onChange),
      _useVModel2 = _slicedToArray__default["default"](_useVModel, 2),
      cascaderValue = _useVModel2[0],
      setCascaderValue = _useVModel2[1];
    var title = vue.computed(function () {
      return props.title || globalConfig.value.title;
    });
    var placeholder = vue.computed(function () {
      return props.placeholder || globalConfig.value.placeholder;
    });
    var stepIndex = vue.ref(0);
    var selectedIndexes = vue.reactive([]);
    var selectedValue = vue.reactive([]);
    var items = vue.reactive([(_options$value = options.value) !== null && _options$value !== void 0 ? _options$value : []]);
    var steps = vue.reactive([placeholder.value]);
    vue.watch(placeholder, function (newValue, oldValue) {
      var index = steps.indexOf(oldValue);
      if (index !== -1) {
        steps[index] = newValue;
      }
    });
    vue.onMounted(function () {
      initWithValue();
    });
    var internalInstance = vue.getCurrentInstance();
    var closeBtnTNode = vue.computed(function () {
      return shared_render.renderTNode(internalInstance, "closeBtn", {
        defaultNode: vue.h(tdesignIconsVueNext.CloseIcon, {
          size: "24px"
        })
      });
    });
    var titleTNode = vue.computed(function () {
      return shared_render.renderTNode(internalInstance, "title");
    });
    var placeholderTNode = vue.computed(function () {
      return shared_render.renderTNode(internalInstance, "placeholder");
    });
    var initWithValue = function initWithValue() {
      if (value.value != null) {
        steps.pop();
        var path = getIndexesByValue(options.value, value.value);
        path === null || path === void 0 || path.forEach(function (e) {
          selectedIndexes.push(e);
        });
        watchSelectedIndexes();
      }
    };
    var watchSelectedIndexes = function watchSelectedIndexes() {
      if (options.value && options.value.length > 0) {
        for (var i = 0, size = selectedIndexes.length; i < size; i += 1) {
          var _items$i, _keys$value$value, _keys$value, _keys$value$label, _keys$value2, _keys$value$children, _keys$value3;
          var index = selectedIndexes[i];
          var next = (_items$i = items[i]) === null || _items$i === void 0 ? void 0 : _items$i[index];
          selectedValue.push(next[(_keys$value$value = (_keys$value = keys.value) === null || _keys$value === void 0 ? void 0 : _keys$value.value) !== null && _keys$value$value !== void 0 ? _keys$value$value : "value"]);
          steps.push(next[(_keys$value$label = (_keys$value2 = keys.value) === null || _keys$value2 === void 0 ? void 0 : _keys$value2.label) !== null && _keys$value$label !== void 0 ? _keys$value$label : "label"]);
          if (next[(_keys$value$children = (_keys$value3 = keys.value) === null || _keys$value3 === void 0 ? void 0 : _keys$value3.children) !== null && _keys$value$children !== void 0 ? _keys$value$children : "children"]) {
            var _keys$value$children2, _keys$value4;
            items.push(next[(_keys$value$children2 = (_keys$value4 = keys.value) === null || _keys$value4 === void 0 ? void 0 : _keys$value4.children) !== null && _keys$value$children2 !== void 0 ? _keys$value$children2 : "children"]);
          }
        }
      }
      if (steps.length < items.length) {
        steps.push(placeholder.value);
      }
      stepIndex.value = items.length - 1;
    };
    var getIndexesByValue = function getIndexesByValue(options2, value2) {
      for (var i = 0; i < options2.length; i++) {
        var _keys$value$value2, _keys$value5, _keys$value$children3, _keys$value6;
        if (options2[i][(_keys$value$value2 = (_keys$value5 = keys.value) === null || _keys$value5 === void 0 ? void 0 : _keys$value5.value) !== null && _keys$value$value2 !== void 0 ? _keys$value$value2 : "value"] === value2) {
          return [i];
        }
        if (options2[i][(_keys$value$children3 = (_keys$value6 = keys.value) === null || _keys$value6 === void 0 ? void 0 : _keys$value6.children) !== null && _keys$value$children3 !== void 0 ? _keys$value$children3 : "children"]) {
          var _keys$value$children4, _keys$value7;
          var res = getIndexesByValue(options2[i][(_keys$value$children4 = (_keys$value7 = keys.value) === null || _keys$value7 === void 0 ? void 0 : _keys$value7.children) !== null && _keys$value$children4 !== void 0 ? _keys$value$children4 : "children"], value2);
          if (res) {
            return [i].concat(_toConsumableArray__default["default"](res));
          }
        }
      }
    };
    var chooseSelect = function chooseSelect(e, level, index, item) {
      var _keys$value$label2, _keys$value8, _item, _keys$value$children5, _keys$value9, _item2, _keys$value$children7, _keys$value11;
      selectedIndexes[level] = index;
      selectedIndexes.length = level + 1;
      selectedValue[level] = String(e);
      selectedValue.length = level + 1;
      steps[level] = item[(_keys$value$label2 = (_keys$value8 = keys.value) === null || _keys$value8 === void 0 ? void 0 : _keys$value8.label) !== null && _keys$value$label2 !== void 0 ? _keys$value$label2 : "label"];
      if ((_item = item[(_keys$value$children5 = (_keys$value9 = keys.value) === null || _keys$value9 === void 0 ? void 0 : _keys$value9.children) !== null && _keys$value$children5 !== void 0 ? _keys$value$children5 : "children"]) !== null && _item !== void 0 && _item.length) {
        var _keys$value$children6, _keys$value10;
        items[level + 1] = item[(_keys$value$children6 = (_keys$value10 = keys.value) === null || _keys$value10 === void 0 ? void 0 : _keys$value10.children) !== null && _keys$value$children6 !== void 0 ? _keys$value$children6 : "children"];
        items.length = level + 2;
        stepIndex.value += 1;
        steps[level + 1] = placeholder.value;
        steps.length = level + 2;
      } else if (((_item2 = item[(_keys$value$children7 = (_keys$value11 = keys.value) === null || _keys$value11 === void 0 ? void 0 : _keys$value11.children) !== null && _keys$value$children7 !== void 0 ? _keys$value$children7 : "children"]) === null || _item2 === void 0 ? void 0 : _item2.length) === 0) {
        childrenInfo.value = e;
        childrenInfo.level = level;
      } else {
        var _keys$value$value3, _keys$value12;
        setCascaderValue(item[(_keys$value$value3 = (_keys$value12 = keys.value) === null || _keys$value12 === void 0 ? void 0 : _keys$value12.value) !== null && _keys$value$value3 !== void 0 ? _keys$value$value3 : "value"], items.map(function (item2, index2) {
          return vue.toRaw(item2 === null || item2 === void 0 ? void 0 : item2[selectedIndexes[index2]]);
        }));
        close("finish");
      }
    };
    var cancelSelect = function cancelSelect(e, level, index, item) {
      var _item3, _keys$value$children8, _keys$value13, _item4, _keys$value$children10, _keys$value15;
      selectedIndexes[level] = index;
      selectedIndexes.length = level;
      selectedValue.length = level;
      steps[level] = String(placeholder.value);
      steps[level + 1] = placeholder.value;
      steps.length = level + 1;
      if ((_item3 = item[(_keys$value$children8 = (_keys$value13 = keys.value) === null || _keys$value13 === void 0 ? void 0 : _keys$value13.children) !== null && _keys$value$children8 !== void 0 ? _keys$value$children8 : "children"]) !== null && _item3 !== void 0 && _item3.length) {
        var _keys$value$children9, _keys$value14;
        items[level + 1] = item[(_keys$value$children9 = (_keys$value14 = keys.value) === null || _keys$value14 === void 0 ? void 0 : _keys$value14.children) !== null && _keys$value$children9 !== void 0 ? _keys$value$children9 : "children"];
      } else if (((_item4 = item[(_keys$value$children10 = (_keys$value15 = keys.value) === null || _keys$value15 === void 0 ? void 0 : _keys$value15.children) !== null && _keys$value$children10 !== void 0 ? _keys$value$children10 : "children"]) === null || _item4 === void 0 ? void 0 : _item4.length) === 0) {
        childrenInfo.value = e;
        childrenInfo.level = level;
      }
    };
    var handleSelect = function handleSelect(e, level) {
      var _props$onPick, _keys$value$value5, _keys$value17;
      var value2 = e;
      var index = items[level].findIndex(function (item2) {
        var _keys$value$value4, _keys$value16;
        return item2[(_keys$value$value4 = (_keys$value16 = keys.value) === null || _keys$value16 === void 0 ? void 0 : _keys$value16.value) !== null && _keys$value$value4 !== void 0 ? _keys$value$value4 : "value"] === value2;
      });
      var item = items[level][index];
      if (item.disabled) {
        return;
      }
      (_props$onPick = props.onPick) === null || _props$onPick === void 0 || _props$onPick.call(props, {
        level: level,
        value: item[(_keys$value$value5 = (_keys$value17 = keys.value) === null || _keys$value17 === void 0 ? void 0 : _keys$value17.value) !== null && _keys$value$value5 !== void 0 ? _keys$value$value5 : "value"],
        index: index
      });
      if (checkStrictly.value && selectedValue.includes(String(value2))) {
        cancelSelect(e, level, index, item);
      } else {
        chooseSelect(e, level, index, item);
      }
    };
    vue.watch(open, function () {
      context.emit("update:visible", open.value);
    });
    vue.watch(visible, function () {
      open.value = visible.value;
    });
    vue.watch(function () {
      return props.options;
    }, function () {
      if (open.value) {
        handleSelect(childrenInfo.value, childrenInfo.level);
      }
    }, {
      deep: true
    });
    var close = function close(trigger) {
      var _props$onClose;
      (_props$onClose = props.onClose) === null || _props$onClose === void 0 || _props$onClose.call(props, {
        trigger: trigger
      });
    };
    var onVisibleChange = function onVisibleChange(visible2, e) {
      if ((e === null || e === void 0 ? void 0 : e.trigger) !== "overlay") return;
      close("overlay");
    };
    var updateCascaderValue = function updateCascaderValue() {
      setCascaderValue(selectedValue[selectedValue.length - 1], items.filter(function (item, index) {
        return !!item && selectedIndexes.length > index;
      }).map(function (item, index) {
        return vue.toRaw(item === null || item === void 0 ? void 0 : item[selectedIndexes[index]]);
      }));
    };
    var onClose = function onClose() {
      open.value = false;
      close("close-btn");
    };
    var onCloseBtn = function onCloseBtn() {
      if (checkStrictly.value) {
        updateCascaderValue();
        onClose();
      } else {
        onClose();
      }
    };
    var onStepClick = function onStepClick(index) {
      stepIndex.value = index;
    };
    var onTabChange = function onTabChange(value2) {
      stepIndex.value = Number(value2);
    };
    return {
      open: open,
      placeholder: placeholder,
      onVisibleChange: onVisibleChange,
      onStepClick: onStepClick,
      onTabChange: onTabChange,
      handleSelect: handleSelect,
      closeBtnTNode: closeBtnTNode,
      titleTNode: titleTNode,
      placeholderTNode: placeholderTNode,
      stepIndex: stepIndex,
      name: name,
      title: title,
      subTitles: subTitles,
      cascaderValue: cascaderValue,
      steps: steps,
      selectedValue: selectedValue,
      selectedIndexes: selectedIndexes,
      items: items,
      setCascaderValue: setCascaderValue,
      onClose: onClose,
      onCloseBtn: onCloseBtn
    };
  }
});

var _hoisted_1 = {
  key: 0
};
var _hoisted_2 = ["onClick"];
var _hoisted_3 = {
  key: 1
};
function render(_ctx, _cache, $props, $setup, $data, $options) {
  var _component_t_node = vue.resolveComponent("t-node");
  var _component_chevron_right_icon = vue.resolveComponent("chevron-right-icon");
  var _component_t_tab_panel = vue.resolveComponent("t-tab-panel");
  var _component_t_tabs = vue.resolveComponent("t-tabs");
  var _component_t_radio_group = vue.resolveComponent("t-radio-group");
  var _component_t_popup = vue.resolveComponent("t-popup");
  return vue.openBlock(), vue.createBlock(_component_t_popup, {
    modelValue: _ctx.open,
    "onUpdate:modelValue": _cache[1] || (_cache[1] = function ($event) {
      return _ctx.open = $event;
    }),
    placement: "bottom",
    onVisibleChange: _ctx.onVisibleChange
  }, {
    default: vue.withCtx(function () {
      return [vue.createElementVNode("div", {
        class: vue.normalizeClass("".concat(_ctx.name))
      }, [vue.createElementVNode("div", {
        class: vue.normalizeClass("".concat(_ctx.name, "__title"))
      }, [!(typeof _ctx.titleTNode === "string") ? (vue.openBlock(), vue.createBlock(_component_t_node, {
        key: 0,
        content: _ctx.titleTNode
      }, null, 8, ["content"])) : (vue.openBlock(), vue.createElementBlock(vue.Fragment, {
        key: 1
      }, [vue.createTextVNode(vue.toDisplayString(_ctx.title), 1)], 64))], 2), vue.createElementVNode("div", {
        class: vue.normalizeClass("".concat(_ctx.name, "__close-btn")),
        onClick: _cache[0] || (_cache[0] = function () {
          return _ctx.onCloseBtn && _ctx.onCloseBtn.apply(_ctx, arguments);
        })
      }, [_ctx.closeBtnTNode ? (vue.openBlock(), vue.createBlock(_component_t_node, {
        key: 0,
        content: _ctx.closeBtnTNode
      }, null, 8, ["content"])) : vue.createCommentVNode("", true)], 2), vue.createElementVNode("div", {
        class: vue.normalizeClass("".concat(_ctx.name, "__content"))
      }, [_ctx.steps && _ctx.steps.length ? (vue.openBlock(), vue.createElementBlock("div", _hoisted_1, [_ctx.theme === "step" ? (vue.openBlock(), vue.createElementBlock("div", {
        key: 0,
        class: vue.normalizeClass("".concat(_ctx.name, "__steps"))
      }, [(vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(_ctx.steps, function (item, index) {
        return vue.openBlock(), vue.createElementBlock("div", {
          key: index,
          class: vue.normalizeClass("".concat(_ctx.name, "__step")),
          onClick: function onClick($event) {
            return _ctx.onStepClick(index);
          }
        }, [vue.createElementVNode("div", {
          class: vue.normalizeClass(["".concat(_ctx.name, "__step-dot"), {
            "t-cascader__step-dot--active": item !== _ctx.placeholder,
            "t-cascader__step-dot--last": index === _ctx.steps.length - 1
          }])
        }, null, 2), vue.createElementVNode("div", {
          class: vue.normalizeClass(["".concat(_ctx.name, "__step-label"), {
            "t-cascader__step-label--active": index === _ctx.stepIndex
          }])
        }, [_ctx.placeholderTNode && !(typeof _ctx.placeholderTNode === "string") && item === _ctx.placeholder ? (vue.openBlock(), vue.createBlock(_component_t_node, {
          key: 0,
          content: _ctx.placeholderTNode
        }, null, 8, ["content"])) : (vue.openBlock(), vue.createElementBlock(vue.Fragment, {
          key: 1
        }, [vue.createTextVNode(vue.toDisplayString(item), 1)], 64))], 2), vue.createVNode(_component_chevron_right_icon, {
          class: vue.normalizeClass("".concat(_ctx.name, "__step-arrow")),
          size: "22"
        }, null, 8, ["class"])], 10, _hoisted_2);
      }), 128))], 2)) : vue.createCommentVNode("", true), _ctx.open && _ctx.theme === "tab" ? (vue.openBlock(), vue.createElementBlock("div", _hoisted_3, [vue.createVNode(_component_t_tabs, {
        id: "tabs",
        value: _ctx.stepIndex,
        "space-evenly": false,
        onChange: _ctx.onTabChange
      }, {
        default: vue.withCtx(function () {
          return [(vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(_ctx.steps, function (item, index) {
            return vue.openBlock(), vue.createBlock(_component_t_tab_panel, {
              key: index,
              value: index,
              label: item
            }, null, 8, ["value", "label"]);
          }), 128))];
        }),
        _: 1
      }, 8, ["value", "onChange"])])) : vue.createCommentVNode("", true)])) : vue.createCommentVNode("", true), _ctx.subTitles && _ctx.subTitles[_ctx.stepIndex] ? (vue.openBlock(), vue.createElementBlock("div", {
        key: 1,
        class: vue.normalizeClass("".concat(_ctx.name, "__options-title"))
      }, vue.toDisplayString(_ctx.subTitles[_ctx.stepIndex]), 3)) : vue.createCommentVNode("", true), vue.createElementVNode("div", {
        class: vue.normalizeClass("".concat(_ctx.name, "__options-container")),
        style: vue.normalizeStyle("width: ".concat(_ctx.items.length + 1, "00vw; transform: translateX(-").concat(_ctx.stepIndex, "00vw);"))
      }, [(vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(_ctx.items, function (options, index) {
        return vue.openBlock(), vue.createElementBlock("div", {
          key: index,
          class: vue.normalizeClass("".concat(_ctx.name, "__options"))
        }, [vue.createVNode(vue.Transition, {
          appear: "",
          name: "slide"
        }, {
          default: vue.withCtx(function () {
            return [vue.createElementVNode("div", {
              class: vue.normalizeClass("cascader-radio-group-".concat(index))
            }, [vue.createVNode(_component_t_radio_group, {
              value: _ctx.selectedValue[index] || "",
              keys: _ctx.keys,
              options: options,
              placement: "right",
              icon: "line",
              borderless: "",
              onChange: function onChange($event) {
                return _ctx.handleSelect($event, index);
              }
            }, null, 8, ["value", "keys", "options", "onChange"])], 2)];
          }),
          _: 2
        }, 1024)], 2);
      }), 128))], 6)], 2)], 2)];
    }),
    _: 1
  }, 8, ["modelValue", "onVisibleChange"]);
}

script.render = render;

exports["default"] = script;
//# sourceMappingURL=cascader.js.map
